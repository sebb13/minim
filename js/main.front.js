window.addEventListener("popstate", function(e){loadHtml(location.pathname.substr('/FR/'.length).replace('.html', ''));$('meta[name=app_current_page]').trigger("change");});function getToken(){return $('meta[name=app_token]').attr("content");}function getLang(){return $('meta[name=app_lang]').attr("content");}function getLangAvailable(){return $('meta[name=app_lang_available]').attr("content");}function getCurrentPage(){return $('meta[name=app_current_page]').attr("content");}function setLang(sLang){$('meta[name=app_lang]').attr("content", sLang);$('meta[name=app_lang]').trigger("change");$('html').attr("lang", sLang);}function addMetaToForm(form, exw_actions){}$.ajaxQ=(function(){var id=0, Q={};$(document).ajaxSend(function(e, jqx){jqx._id=++id;Q[jqx._id]=jqx;});$(document).ajaxComplete(function(e, jqx){delete Q[jqx._id];});return{abortAll: function(){if(console && console.log){console.log('abort');}var r=[];$.each(Q, function(i, jqx){r.push(jqx._id);jqx.abort();});return r;}};})();var localCache={timeout: 30000,data:{},remove: function (url){delete localCache.data[url];},exist: function (url){return !!localCache.data[url] && ((new Date().getTime() - localCache.data[url]._) < localCache.timeout);},get: function (url){if(console && console.log){console.log('Getting in cache for url ' + url);}return localCache.data[url].data;},set: function (url, cachedData, callback){localCache.remove(url);localCache.data[url]={_: new Date().getTime(),data: cachedData};if ($.isFunction(callback)) callback(cachedData);}};$.ajaxPrefilter(function(options, originalOptions, jqXHR){if (options.cache){var complete=originalOptions.complete || $.noop,url=originalOptions.url;options.cache=false;options.beforeSend=function (){if (localCache.exist(url) && originalOptions.cache===true){complete(localCache.get(url));return false;}return true;};options.complete=function (data, textStatus){localCache.set(url, data, complete);};}return false;});function addMsg(sType, sContents){var sDiv='<div class="alert alert-'+sType+' alert-dismissible" role="alert">'+'<button type="button" class="close" data-dismiss="alert" aria-label="Close"><span aria-hidden="true">&times;</span></button>'+sContents+'</div>';$('div#ajaxFrame').prepend(sDiv);return true;}function genericRequest(data, sPage, sLang){if(typeof sPage==='undefined') sPage=getCurrentPage();if(typeof sLang==='undefined') sLang=getLang();return $.ajax({url: "https://"+window.location.hostname+"/index.php?page="+sPage+"&lang="+sLang,method: "POST",async: true,data: data});}function loadHtml(sPage){$('body').css({'cursor':'wait'});var sLang=getLang();var promise=genericRequest({app_token: getToken(), content: sPage}, sPage, sLang);promise.success(function(data){if (sPage==='menu'){$("ul.menu").fadeOut('500', function(){$("ul.menu").html(data);$("ul.menu").fadeIn('500');});return true;}else{$("#ajaxFrame").fadeOut('500', function(){$("#ajaxFrame").html(data);updateLangSwitcher(sPage);setHistoryAndMenu(sPage);ajaxFrameRebind();$("#ajaxFrame").fadeIn('500');});}if(sPage !=='menu' && sPage !=='player' && typeof(ga) !=='undefined'){ga('send', ['_trackPageview', '/'+sLang+'/'+sPage.replace('_', '/')+'.html']);}$('html, body').animate({scrollTop: 0});$('body').css({'cursor':'default'});return true;});promise.error(function(request,error){if(console && console.log){console.log('AJAX error');}$('body').css({'cursor':'default'});return false;});}function getWaitContents(oElmt, sClass){sClass=sClass || 'loader';return oElmt.html('<div class="'+sClass+'"></div>');}function updateMenu(sPage){$('.ajaxLink').each(function(){$(this).removeClass('currentPage');$(this).parent().removeClass('active');});$('#'+sPage).addClass('currentPage');$('#'+sPage).parent().addClass('active');if($('#'+sPage).is('.sub_menu')){$('a:first', $('#'+sPage).closest('ul').closest('li')).addClass('currentPage');}return true;}function setHistoryAndMenu(sPage){updateMenu(sPage);if (!$.browser.msie || parseInt($.browser.version) >=10){history.pushState(null, sPage, '/'+getLang()+'/'+sPage.replace('_', '/')+'.html');}$('meta[name=app_current_page]').attr("content", sPage);$('meta[name=app_current_page]').trigger('change');$('title').text(sPage+' - '+window.location.host);return true;}function updateLangSwitcher(sPage){$.each($.parseJSON(getLangAvailable()), function(iIndex,sLangName){$('#'+sLangName).attr('href', '/'+sLangName+'/'+sPage.replace('_', '/')+'.html');});}function getHasChanges(withSelect){var hasChanges=false;$(":input:not(:button):not([type=hidden])").each(function (){if ((this.type==="text" || this.type==="textarea" || this.type==="hidden") && this.defaultValue !==this.value){hasChanges=true;return false;}else{if ((this.type==="radio" || this.type==="checkbox") && this.defaultChecked !==this.checked){hasChanges=true;return false;}else{if ((this.type==="select-one" || this.type==="select-multiple") && withSelect){for (var x=0; x < this.length; x++){if (this.options[x].selected !==this.options[x].defaultSelected){hasChanges=true;return false;}}}}}});return hasChanges;}function ajaxFrameRebind(){$('.noscript').hide();$('[data-toggle="tooltip"]').tooltip();if ($(".cbox")){$(".cbox").colorbox({rel:'cbox'});}}Date.prototype.getWeek=function (){var target=new Date(this.valueOf());var dayNr=(this.getDay() + 6) % 7;target.setDate(target.getDate() - dayNr + 3);var firstThursday=target.valueOf();target.setMonth(0, 1);if (target.getDay() !==4){target.setMonth(0, 1 + ((4 - target.getDay()) + 7) % 7);}return 1 + Math.ceil((firstThursday - target) / 604800000);};Date.prototype.getWeekYear=function (){var target=new Date(this.valueOf());target.setDate(target.getDate() - ((this.getDay() + 6) % 7) + 3);return target.getFullYear();};function htmlEntities(str){return String(str).replace(/&/g, '&amp;').replace(/</g, '&lt;').replace(/>/g, '&gt;').replace(/"/g, '&quot;');}function checkContactForm(){var errors='';var reg=new RegExp('^[a-z0-9]+([_|\.|-]{1}[a-z0-9]+)*@[a-z0-9]+([_|\.|-]{1}[a-z0-9]+)*[\.]{1}[a-z]{2,6}$', 'i');if($("#contact_name").val()===''){errors +='<li>'+$("#error_missing_name").val()+'</li>';}if($("#contact_email").val()===''){errors +='<li>'+$("#error_missing_email").val()+'</li>';}else if(!reg.test($("#contact_email").val())){errors +='<li>'+$("#error_invalid_email").val()+'</li>';}if($("#contact_msg").val()===''){errors +='<li>'+$("#error_missing_msg").val()+'</li>';}if (errors !==''){addMsg('danger', errors);return false;}else{return true;}}function setFooterWording(){if(getLang()==='FR'){$('a#partners').html('Partenaires');$('a#legalNotices').html('Mentions l√©gales');}else{$('a#partners').html('Partners');$('a#legalNotices').html('Legal notices');}}(function($){$.pageLoader=function(){$('.gPlus').hide();var $elements=$('body').find('img[src]');$('body [style]').each(function(){var src=$(this).css('background-image').replace(/^url\(["']?/, '').replace(/["']?\)$/, '');if(src && src !=='none'){$elements=$elements.add($('<img src="' + src + '"/>'));}});var $loading=$('#loading');var $loadingInfos=$('#loading-infos');var loadedItems=0;var timeMs=1000;function animateStep(now, fx){$loadingInfos.text(parseInt(now)+'%');}function loadingInProgress(){var percentage=0;if($elements.length){percentage=parseInt((loadedItems / $elements.length) * 100);}$loadingInfos.stop() .animate({width:percentage + '%'}, timeMs);$loading.stop() .animate({percentage:percentage},{duration: timeMs,step: animateStep});}function loadingCompleted(){var percentage=100;$loadingInfos.stop() .animate({width:percentage + '%'}, (timeMs / 2));$loading.stop() .animate({percentage:percentage},{duration: (timeMs / 2),step: animateStep}).css({opacity: 1}).animate({opacity: 0}, function(){$loading.css({display:'none'});$('#main-contents-container').css({opacity: 0,visibility:'visible'}).animate({opacity:1});$('.gPlus').show();});}if($elements.length){loadingInProgress();$elements.load(function(){$(this).off('load');loadedItems++;loadingInProgress();});}$(window).load(function(){loadingCompleted();});};})(jQuery);$(document).ready(function(){ajaxFrameRebind();$('.nav a').on('click', function(){if($('.sr-only').is(':visible')){$('.navbar-toggle').click();}});$('div#ajaxFrame').on('click', 'button, input[type=button]', function(e){$(this).blur();});$('meta[name=app_current_page]').change(function(){ajaxFrameRebind();});$('div#ajaxFrame').on('click', '[data-toggle="tooltip"]', function(e){e.preventDefault();return false;});var duration=300;jQuery(window).scroll(function(){if(jQuery(this).scrollTop() > 100){jQuery('.cTop').fadeIn(duration);}else{jQuery('.cTop').fadeOut(duration);}});jQuery('.cTop').click(function(event){event.preventDefault();jQuery('html, body').animate({scrollTop: 0}, duration);return false;});updateMenu(getCurrentPage());$('ul.menu').on('click', 'a.ajaxLink', function(e){$(this).blur();$.ajaxQ.abortAll();e.preventDefault();e.stopPropagation();var sPage=$(this).attr("id");return loadHtml(sPage);});$('body').on('click', 'a.ajaxLink', function(e){$(this).blur();$.ajaxQ.abortAll();e.preventDefault();e.stopPropagation();var sPage=$(this).attr("id");if(sPage.indexOf("_____")===0){sPage=sPage.substring(sPage.indexOf("_____")+5);}else if(sPage.indexOf("____")===0){sPage=sPage.substring(sPage.indexOf("____")+4);}else if(sPage.indexOf("___")===0){sPage=sPage.substring(sPage.indexOf("___")+3);}else if(sPage.indexOf("__")===0){sPage=sPage.substring(sPage.indexOf("__")+2);}else if(sPage.indexOf("_")===0){sPage=sPage.substring(sPage.indexOf("_")+1);}return loadHtml(sPage);});$('#langSwitcher').on('click', 'a.lang-button', function(e){$.ajaxQ.abortAll();e.preventDefault();e.stopPropagation();var sPage=getCurrentPage();var sLang=$(this).attr('id');$('.lang-button').each(function(){$(this).removeClass('on');$(this).addClass('off');});$(this).removeClass('off');$(this).addClass('on');setLang(sLang);loadHtml('menu');return loadHtml(sPage);});if($('#systemDialog').length===1){$('#systemDialog').dialog({modal: true,buttons:{Ok: function(){$(this).dialog("close");}}});}$('form#cookiesConsentAcceptForm').on('click', 'button#cookiesConsentAcceptButton', function(){var promise=genericRequest({app_token: getToken(), content: getCurrentPage(),exw_action: 'Core::CookiesConsent'});promise.success(function(data){$('div.cookies-consent-banner').hide();});});$('meta[name=app_lang]').change(function(){var promise=genericRequest({app_token: getToken(), content: getCurrentPage(),exw_action: 'Core::getCookiesConsentBanner'});promise.success(function(data){$('div.cookies-consent-banner').replaceWith(data);});});$('div#ajaxFrame').on('click', '.contact-send-button', function(e){e.preventDefault();e.stopPropagation();$(".alert").css('display', 'none');if(checkContactForm()){$('#contactForm').append('<input type="hidden" name="app_token" value="'+getToken()+'" />');$('#contactForm').append('<input type="hidden" name="content" value="'+getCurrentPage()+'" />');$('#contactForm').append('<input type="hidden" name="exw_action" value="Contact::addMsg" />');var formdata=(window.FormData) ? new FormData($('#contactForm')[0]) : null;var data=(formdata !==null) ? formdata : $('#contactForm').serialize();$(".progress").css('display', 'block');$.ajax({type: 'POST',cache:'false',contentType: false,processData: false,url: "https://"+window.location.hostname+"/index.php?page="+getCurrentPage()+"&lang="+getLang(),xhr: function(){var xhr=new window.XMLHttpRequest();xhr.upload.addEventListener("progress", function(evt){if (evt.lengthComputable){var percentComplete=evt.loaded / evt.total;$("#progressbar").attr('aria-valuenow', Math.round(percentComplete*100));$("#progressbar").text(Math.round(percentComplete*100)+'%');$("#progressbar").css('width', Math.round(percentComplete*100)+'%');}}, false);return xhr;},data: data,success: function(data){$('div#ajaxFrame').html(data);},error:function(){alert('error');}});}});$.pageLoader();var myImages=new Array ('/img/design/sn/facebook.png','/img/design/sn/instagram.png','/img/design/sn/linkedin.png','/img/design/sn/google+.png');var myPreload=new Array ();for (var i=0; i < myImages.length; i++ ){myPreload[i]=new Image();myPreload[i].src=myImages[i];}setFooterWording();$('meta[name=app_current_page]').change(function(){if($('.pageNotFound').is(':visible')){$('footer').css({position : "absolute",bottom: "0"});}else{$('footer').css({position : "relative"});}});$('meta[name=app_lang]').change(function(){setFooterWording();});if($('.pageNotFound').is(':visible') || getCurrentPage()==='maintenance'){$('footer').css({position : "absolute",bottom: "0"});}else{$('footer').css({position : "relative"});}});