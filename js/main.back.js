window.addEventListener("popstate", function(e){loadHtml(location.pathname.substr('/FR/'.length).replace('.html', ''));$('meta[name=app_current_page]').trigger("change");});function getToken(){return $('meta[name=app_token]').attr("content");}function getLang(){return $('meta[name=app_lang]').attr("content");}function getLangAvailable(){return $('meta[name=app_lang_available]').attr("content");}function getCurrentPage(){return $('meta[name=app_current_page]').attr("content");}function setLang(sLang){$('meta[name=app_lang]').attr("content", sLang);$('meta[name=app_lang]').trigger("change");$('html').attr("lang", sLang);}function addMetaToForm(form, exw_actions){}$.ajaxQ=(function(){var id=0, Q={};$(document).ajaxSend(function(e, jqx){jqx._id=++id;Q[jqx._id]=jqx;});$(document).ajaxComplete(function(e, jqx){delete Q[jqx._id];});return{abortAll: function(){if(console && console.log){console.log('abort');}var r=[];$.each(Q, function(i, jqx){r.push(jqx._id);jqx.abort();});return r;}};})();var localCache={timeout: 30000,data:{},remove: function (url){delete localCache.data[url];},exist: function (url){return !!localCache.data[url] && ((new Date().getTime() - localCache.data[url]._) < localCache.timeout);},get: function (url){if(console && console.log){console.log('Getting in cache for url ' + url);}return localCache.data[url].data;},set: function (url, cachedData, callback){localCache.remove(url);localCache.data[url]={_: new Date().getTime(),data: cachedData};if ($.isFunction(callback)) callback(cachedData);}};$.ajaxPrefilter(function(options, originalOptions, jqXHR){if (options.cache){var complete=originalOptions.complete || $.noop,url=originalOptions.url;options.cache=false;options.beforeSend=function (){if (localCache.exist(url) && originalOptions.cache===true){complete(localCache.get(url));return false;}return true;};options.complete=function (data, textStatus){localCache.set(url, data, complete);};}return false;});function addMsg(sType, sContents){var sDiv='<div class="alert alert-'+sType+' alert-dismissible" role="alert">'+'<button type="button" class="close" data-dismiss="alert" aria-label="Close"><span aria-hidden="true">&times;</span></button>'+sContents+'</div>';$('div#ajaxFrame').prepend(sDiv);return true;}function genericRequest(data, sPage, sLang){if(typeof sPage==='undefined') sPage=getCurrentPage();if(typeof sLang==='undefined') sLang=getLang();return $.ajax({url: "https://"+window.location.hostname+"/index.php?page="+sPage+"&lang="+sLang,method: "POST",async: true,data: data});}function loadHtml(sPage){$('body').css({'cursor':'wait'});var sLang=getLang();var promise=genericRequest({app_token: getToken(), content: sPage}, sPage, sLang);promise.success(function(data){if (sPage==='menu'){$("ul.menu").fadeOut('500', function(){$("ul.menu").html(data);$("ul.menu").fadeIn('500');});return true;}else{$("#ajaxFrame").fadeOut('500', function(){$("#ajaxFrame").html(data);updateLangSwitcher(sPage);setHistoryAndMenu(sPage);ajaxFrameRebind();$("#ajaxFrame").fadeIn('500');});}if(sPage !=='menu' && sPage !=='player' && typeof(ga) !=='undefined'){ga('send', ['_trackPageview', '/'+sLang+'/'+sPage.replace('_', '/')+'.html']);}$('html, body').animate({scrollTop: 0});$('body').css({'cursor':'default'});return true;});promise.error(function(request,error){if(console && console.log){console.log('AJAX error');}$('body').css({'cursor':'default'});return false;});}function getWaitContents(oElmt, sClass){sClass=sClass || 'loader';return oElmt.html('<div class="'+sClass+'"></div>');}function updateMenu(sPage){$('.ajaxLink').each(function(){$(this).removeClass('currentPage');$(this).parent().removeClass('active');});$('#'+sPage).addClass('currentPage');$('#'+sPage).parent().addClass('active');if($('#'+sPage).is('.sub_menu')){$('a:first', $('#'+sPage).closest('ul').closest('li')).addClass('currentPage');}return true;}function setHistoryAndMenu(sPage){updateMenu(sPage);if (!$.browser.msie || parseInt($.browser.version) >=10){history.pushState(null, sPage, '/'+getLang()+'/'+sPage.replace('_', '/')+'.html');}$('meta[name=app_current_page]').attr("content", sPage);$('meta[name=app_current_page]').trigger('change');$('title').text(sPage+' - '+window.location.host);return true;}function updateLangSwitcher(sPage){$.each($.parseJSON(getLangAvailable()), function(iIndex,sLangName){$('#'+sLangName).attr('href', '/'+sLangName+'/'+sPage.replace('_', '/')+'.html');});}function getHasChanges(withSelect){var hasChanges=false;$(":input:not(:button):not([type=hidden])").each(function (){if ((this.type==="text" || this.type==="textarea" || this.type==="hidden") && this.defaultValue !==this.value){hasChanges=true;return false;}else{if ((this.type==="radio" || this.type==="checkbox") && this.defaultChecked !==this.checked){hasChanges=true;return false;}else{if ((this.type==="select-one" || this.type==="select-multiple") && withSelect){for (var x=0; x < this.length; x++){if (this.options[x].selected !==this.options[x].defaultSelected){hasChanges=true;return false;}}}}}});return hasChanges;}function ajaxFrameRebind(){$('.noscript').hide();$('[data-toggle="tooltip"]').tooltip();if ($(".cbox")){$(".cbox").colorbox({rel:'cbox'});}}Date.prototype.getWeek=function (){var target=new Date(this.valueOf());var dayNr=(this.getDay() + 6) % 7;target.setDate(target.getDate() - dayNr + 3);var firstThursday=target.valueOf();target.setMonth(0, 1);if (target.getDay() !==4){target.setMonth(0, 1 + ((4 - target.getDay()) + 7) % 7);}return 1 + Math.ceil((firstThursday - target) / 604800000);};Date.prototype.getWeekYear=function (){var target=new Date(this.valueOf());target.setDate(target.getDate() - ((this.getDay() + 6) % 7) + 3);return target.getFullYear();};function htmlEntities(str){return String(str).replace(/&/g, '&amp;').replace(/</g, '&lt;').replace(/>/g, '&gt;').replace(/"/g, '&quot;');}function getErrorLogsGraph(){var chartTarget='';var chartWidth=0;if($('div#chart_div').is(':visible')){chartTarget='#'+$('div#chart_div').attr('id');chartWidth=$('div#chart_div').parent().parent().parent().width()-20;}if($('div#chart_div_home').is(':visible')){chartTarget='#'+$('div#chart_div_home').attr('id');chartWidth=$('div#chart_div_home').parent().parent().width()-20;}if(chartWidth !==0){var promise=genericRequest({app_token: getToken(), content: getCurrentPage(),dataType: 'json',exw_action: 'Logs::getJsonForCharts'});promise.success(function(JSONdata){var chart=c3.generate({bindto: chartTarget,data:{x: 'x',columns: JSON.parse(JSONdata),colors:{nbErrors:'#c63531'}},axis:{x:{type: 'timeseries',tick:{format: '%d-%m-%y'}},nbErrors:{min: 0}},size:{width: chartWidth}});});promise.error(function(){alert('error');});}return true;}$(document).ready(function(){ajaxFrameRebind();$('.nav a').on('click', function(){if($('.sr-only').is(':visible')){$('.navbar-toggle').click();}});$('div#ajaxFrame').on('click', 'button, input[type=button]', function(e){$(this).blur();});$('meta[name=app_current_page]').change(function(){ajaxFrameRebind();});$('div#ajaxFrame').on('click', '[data-toggle="tooltip"]', function(e){e.preventDefault();return false;});var duration=300;jQuery(window).scroll(function(){if(jQuery(this).scrollTop() > 100){jQuery('.cTop').fadeIn(duration);}else{jQuery('.cTop').fadeOut(duration);}});jQuery('.cTop').click(function(event){event.preventDefault();jQuery('html, body').animate({scrollTop: 0}, duration);return false;});updateMenu(getCurrentPage());$('ul.menu').on('click', 'a.ajaxLink', function(e){$(this).blur();$.ajaxQ.abortAll();e.preventDefault();e.stopPropagation();var sPage=$(this).attr("id");return loadHtml(sPage);});$('body').on('click', 'a.ajaxLink', function(e){$(this).blur();$.ajaxQ.abortAll();e.preventDefault();e.stopPropagation();var sPage=$(this).attr("id");if(sPage.indexOf("_____")===0){sPage=sPage.substring(sPage.indexOf("_____")+5);}else if(sPage.indexOf("____")===0){sPage=sPage.substring(sPage.indexOf("____")+4);}else if(sPage.indexOf("___")===0){sPage=sPage.substring(sPage.indexOf("___")+3);}else if(sPage.indexOf("__")===0){sPage=sPage.substring(sPage.indexOf("__")+2);}else if(sPage.indexOf("_")===0){sPage=sPage.substring(sPage.indexOf("_")+1);}return loadHtml(sPage);});$('#langSwitcher').on('click', 'a.lang-button', function(e){$.ajaxQ.abortAll();e.preventDefault();e.stopPropagation();var sPage=getCurrentPage();var sLang=$(this).attr('id');$('.lang-button').each(function(){$(this).removeClass('on');$(this).addClass('off');});$(this).removeClass('off');$(this).addClass('on');setLang(sLang);loadHtml('menu');return loadHtml(sPage);});if($('#systemDialog').length===1){$('#systemDialog').dialog({modal: true,buttons:{Ok: function(){$(this).dialog("close");}}});}bootbox.setDefaults({locale: (getLang()==='GB' ? 'en' : getLang().toLowerCase()),});if($('form#loginForm').is(':visible')){$('button.userHeaderButton').hide();}else{$('button.userHeaderButton').show();}var sStartPage=window.location.pathname.substring(window.location.pathname.lastIndexOf('/')+1);if(!$('form#loginForm').is(':visible') && sStartPage==='login.html'){setHistoryAndMenu('home');}$('.menu').on('click', 'a.sub_menu', function(){$('li.dropdown').removeClass('open');});$('div#ajaxFrame').on('click', 'button.backHomeButton', function(){window.location='/';});$('.summernote').summernote({airMode: true});$('.note-editable').first().focus();getErrorLogsGraph();$('meta[name=app_current_page]').change(function(){bootbox.setDefaults({locale: (getLang()==='GB' ? 'en' : getLang().toLowerCase()),});$('.summernote').summernote({airMode: true});$('.note-editable').first().focus();getErrorLogsGraph();});$(document.body).on('click', 'button,radio', function(){$(this).blur();return true;});$(document.body).on('click', 'button.close, a.ajaxLink', function(){$('meta[name=app_current_page]').trigger('change');return true;});$('div#ajaxFrame').on('click', '#to-copy', function(e){$('#to-copy-target').select();document.execCommand( 'copy' );return false;});$(document.body).on('click', 'button#editUserButton', function(e){e.preventDefault();e.stopPropagation();var promise=genericRequest({app_token: getToken(), content: 'user',exw_action: 'User::getUserPage',}, 'user');promise.success(function(data){$('div#ajaxFrame').html(data);setHistoryAndMenu('user');$('meta[name=app_current_page]').trigger('change');});promise.error(function(){bootbox.alert('error');});return false;});$('div#ajaxFrame').on('click', 'button#addUserButton', function(e){e.preventDefault();e.stopPropagation();var promise=genericRequest({app_token: getToken(), content: getCurrentPage(),exw_action: 'User::addUser',login: $('input#user_login').val(),pwd: $('input#user_pwd').val(),role: $('select#user_role').val()});promise.success(function(data){$('div#ajaxFrame').html(data);$('meta[name=app_current_page]').trigger('change');});promise.error(function(){bootbox.alert('error');});return false;});$('div#ajaxFrame').on('click', 'button.removeUserButton', function(e){e.preventDefault();e.stopPropagation();var user=$(this).prev().val();var sConfirmText=$('input#confirmDeleteUserAccountMsg').val() + ' ('+user+')';bootbox.confirm(sConfirmText, function(result){if(result){var promise=genericRequest({app_token: getToken(), content: getCurrentPage(),exw_action: 'User::deleteUser',user: user});promise.success(function(data){$('div#ajaxFrame').html(data);$('meta[name=app_current_page]').trigger('change');});promise.error(function(){bootbox.alert('error');});}});return false;});$('div#ajaxFrame').on('click', 'button#updateUserButton', function(e){e.preventDefault();e.stopPropagation();bootbox.confirm($('input#confirmUpdateUserAccountMsg').val(), function(result){if(result){var promise=genericRequest({app_token: getToken(), content: getCurrentPage(),exw_action: 'User::updateUser',user: $('input#currentUserLogin').val(),login: $('input#login').val(),pwd: $('input#pwd').val(),currentPwd: $('input#currentPwd').val()});promise.success(function(data){$('div#ajaxFrame').html(data);$('#editUserButton').html($('input#login').val());$('meta[name=app_current_page]').trigger('change');});promise.error(function(){bootbox.alert('error');});}});return false;});$('div#ajaxFrame').on('click', 'button#updateUsersButton', function(e){e.preventDefault();e.stopPropagation();bootbox.confirm($('input#confirmUpdateUsersAccountMsg').val(), function(result){if(result){var promise=genericRequest({app_token: getToken(), content: getCurrentPage(),exw_action: 'User::updateUsers',users: $('#updateUsersForm').serializeArray()});promise.success(function(data){$('div#ajaxFrame').html(data);$('meta[name=app_current_page]').trigger('change');});promise.error(function(){bootbox.alert('error');});}});return false;});$('div#ajaxFrame').on('keyup', 'input[name^="login"]', function(e){var regex=new RegExp(/([^A-Za-z0-9\-])/);if (regex.test($(this).val())){$(this).css({color:'#fff', 'background-color':'#c83834'});return false;}else{$(this).css({color:'#555555', 'background-color':'#fff'});}});$('div#ajaxFrame').on('submit', 'form.checkUpdateForm', function(e){e.preventDefault();e.stopPropagation();var promise=genericRequest({app_token: getToken(), content: getCurrentPage(),exw_action: 'Core::getPageConfig',pageToConfigure: $('select#pageToConfigure').val()});promise.success(function(data){$('div#ajaxFrame').html(data);});promise.error(function(){bootbox.alert('error');});return false;});$('div#ajaxFrame').on('click', 'input.checkUpdateButton', function(){getWaitContents($(this).parent().prev());var promise=genericRequest({app_token: getToken(), content: getCurrentPage(),exw_action: 'Updates::checkUpdate',sModuleToCheck: $(this).prev().val()});promise.success(function(data){$('div#ajaxFrame').html(data);});promise.error(function(){bootbox.alert('error');});return false;});$('div#ajaxFrame').on('click', 'button.generateUpdatesButton', function(){var sMainVersion=$(this).prev().parent().find('input[name=main-version]').val();var sSubVersion=$(this).parent().parent().find('input[name=sub-version]').val();var sRelease=$(this).parent().parent().find('input[name=release]').val();var sModuleName=$(this).parent().parent().find('input[name=module-name]').val();var spinnerDiv=$(this).parent();bootbox.confirm($('input#confirmGenerateUpdates').val(), function(result){if(result){getWaitContents(spinnerDiv);var promise=genericRequest({app_token: getToken(), content: getCurrentPage(),exw_action: 'Updates::generateUpdates',sMainVersion: sMainVersion,sSubVersion: sSubVersion,sRelease: sRelease,sModuleName: sModuleName});promise.success(function(data){$('div#ajaxFrame').html(data);});promise.error(function(){bootbox.alert('error');});}});return false;});$('div#ajaxFrame').on('click', 'input.updateSystemButton', function(){var sModuleName=$(this).prev().val();var sConfirmMsg=$(this).prev().prev().val();var spinnerDiv=$(this).parent();bootbox.confirm(sConfirmMsg, function(result){if(result){getWaitContents(spinnerDiv);var promise=genericRequest({app_token: getToken(), content: getCurrentPage(),exw_action: 'Updates::installUpdates',sModuleName: sModuleName});promise.success(function(data){$('div#ajaxFrame').html(data);});promise.error(function(){bootbox.alert('error');});}});return false;});$('div#ajaxFrame').on('click', 'input.rollback', function(){var sModuleName=$(this).parent().parent().find('input[name=module_name]').val();var sConfirmMsg=$(this).parent().parent().find('input[name=confirmRollbackMsg]').val();var sVersion=$(this).parent().parent().find('input[name=version]').val();var spinnerDiv=$(this).parent();bootbox.confirm(sConfirmMsg, function(result){if(result){getWaitContents(spinnerDiv);var promise=genericRequest({app_token: getToken(), content: getCurrentPage(),exw_action: 'Updates::rollback',sModuleName: sModuleName,sVersion: sVersion});promise.success(function(data){$('div#ajaxFrame').html(data);});promise.error(function(){bootbox.alert('error');});}});return false;});$('div#ajaxFrame').on('click', 'input.purgeBackup', function(){var sModuleName=$(this).parent().parent().find('input[name=module_name]').val();var sConfirmMsg=$(this).parent().parent().find('input[name=confirmPurgeBackupMsg]').val();var sVersion=$(this).parent().parent().find('input[name=version]').val();var spinnerDiv=$(this).parent();bootbox.confirm(sConfirmMsg, function(result){if(result){getWaitContents(spinnerDiv);var promise=genericRequest({app_token: getToken(), content: getCurrentPage(),exw_action: 'Updates::purgeBackup',sModuleName: sModuleName,sVersion: sVersion});promise.success(function(data){$('div#ajaxFrame').html(data);});promise.error(function(){bootbox.alert('error');});}});return false;});$('div#ajaxFrame').on('submit', 'form.systemForm', function(e){e.preventDefault();e.stopPropagation();var aPage=$(this).attr("action").split("/");var sPage=(aPage.length===4) ? aPage[2] + '_' + aPage[3] : aPage[2];sPage=sPage.substring(0, sPage.indexOf("."));loadHtml(sPage);setHistoryAndMenu(sPage);return false;});$('div#ajaxFrame').on('change', 'select#pageToConfigure', function(e){var promise=genericRequest({app_token: getToken(), content: getCurrentPage(),exw_action: 'Pages::getPageConfig',pageToConfigure: $('select#pageToConfigure').val()});promise.success(function(data){$('div#ajaxFrame').html(data);$('meta[name=app_current_page]').trigger('change');});promise.error(function(){bootbox.alert('error');});return true;});$('div#ajaxFrame').on('click', 'input#addPage', function(e){var promise=genericRequest({app_token: getToken(), content: getCurrentPage(),exw_action: 'Pages::addPageToConfigure',newPageName: $('input#newPageName').val()});promise.success(function(data){$('div#ajaxFrame').html(data);$('meta[name=app_current_page]').trigger('change');});return true;});$('div#ajaxFrame').on('click', 'input#deleteConf', function(e){bootbox.confirm($('input#deletePageConfConfirm').val(), function(result){if(result){var promise=genericRequest({app_token: getToken(), content: getCurrentPage(),exw_action: 'Pages::deletePageToConfigure',deletePageName: $('select#pageToConfigure').val()});promise.success(function(data){$('div#ajaxFrame').html(data);$('meta[name=app_current_page]').trigger('change');});}return true;});});$('div#ajaxFrame').on('click', 'input#last-mod', function(e){bootbox.confirm($('input#regenerateSitemapConfirm').val(), function(result){if(result){var promise=genericRequest({app_token: getToken(), content: getCurrentPage(),exw_action: 'Pages::regenerateSitemap'});promise.success(function(data){$('div#ajaxFrame').html(data);});}return true;});});$('div#ajaxFrame').on('change', 'select#sFileToTranslate, select#sRefLang, select#sLangToTranslate', function(e){if (getHasChanges(false)===true){if (!confirm('Êtes vous sûr de ne pas vouloir enregistrer vos modifications ?')){for (var x=0; x < this.length; x++){this.options[x].selected=this.options[x].defaultSelected;}return false;}}getWaitContents($('#translations_container'));var promise=genericRequest({app_token: getToken(), content: getCurrentPage(),exw_action: 'Translations::getTranslationsInterface',sFileToTranslate: $('select#sFileToTranslate').val(),sRefLang: $('select#sRefLang').val(),sLangToTranslate: $('select#sLangToTranslate').val()});promise.success(function(data){$('div#ajaxFrame').html(data);$('meta[name=app_current_page]').trigger('change');});promise.error(function(){bootbox.alert('error');});return true;});$('div#ajaxFrame').on('click', '#resetTranslationsDraft', function(e){var promise=genericRequest({app_token: getToken(), content: getCurrentPage(),exw_action: 'Translations::resetDraft',sFileToTranslate: $('select#sFileToTranslate').val(),sRefLang: $('select#sRefLang').val(),sLangToTranslate: $('select#sLangToTranslate').val()});promise.success(function(data){$('div#ajaxFrame').html(data);$('.summernote').summernote({airMode: true});jQuery('html, body').animate({scrollTop: 0}, 300);});promise.error(function(){bootbox.alert('error');});return false;});$('div#ajaxFrame').on('click', '#saveTranslationsButton', function(e){var oTranslates={};$('.summernote').each(function(){oTranslates[$(this).attr('id')]=$(this).next().find('.note-editable').html();});var promise=genericRequest({app_token: getToken(), content: getCurrentPage(),exw_action: 'Translations::saveTranslations',translates:oTranslates,sFileToTranslate: $('select#sFileToTranslate').val(),sRefLang: $('select#sRefLang').val(),sLangToTranslate: $('select#sLangToTranslate').val()});promise.success(function(data){$('div#ajaxFrame').html(data);$('.summernote').summernote({airMode: true});jQuery('html, body').animate({scrollTop: 0}, 300);});promise.error(function(){bootbox.alert('error');});return false;});$('div#ajaxFrame').on('click', '#publishTranslationsDraft', function(e){var promise=genericRequest({app_token: getToken(), content: getCurrentPage(),exw_action: 'Translations::publishTranslations',sFileToTranslate: $('select#sFileToTranslate').val(),sRefLang: $('select#sRefLang').val(),sLangToTranslate: $('select#sLangToTranslate').val()});promise.success(function(data){$('div#ajaxFrame').html(data);$('.summernote').summernote({airMode: true});jQuery('html, body').animate({scrollTop: 0}, 300);});promise.error(function(){bootbox.alert('error');});return false;});$('div#ajaxFrame').on('change', 'select#moduleToConfigure, select#sideToConfigure', function(e){var promise=genericRequest({app_token: getToken(), content: getCurrentPage(),exw_action: 'Routing::getRoutingInterface',sModuleToConfigure: $('select#moduleToConfigure').val(),sSideToConfigure: $('select#sideToConfigure').val()});promise.success(function(data){$('div#ajaxFrame').html(data);$('meta[name=app_current_page]').trigger('change');});promise.error(function(){bootbox.alert('error');});return false;});$('div#ajaxFrame').on('click', 'button#getNewRouteEntries', function(e){e.preventDefault();e.stopPropagation();var promise=genericRequest({app_token: getToken(), content: getCurrentPage(),exw_action: 'Routing::getNewRouteEntries',sType: $('#type').val(),nbRoutesToAdd: $('#nbRoutesToAdd').val(),sModuleToConfigure: $('select#moduleToConfigure').val(),sSideToConfigure: $('select#sideToConfigure').val()});promise.success(function(data){$('div#newRoutes').html(data);});promise.error(function(){bootbox.alert('error');});return false;});$('div#ajaxFrame').on('click', 'button.removeRoute', function(e){e.preventDefault();e.stopPropagation();var sPageToRemove=$(this).attr('id');bootbox.confirm($('input#removeRouteConfirm').val(), function(result){if(result){var promise=genericRequest({app_token: getToken(), content: getCurrentPage(),exw_action: 'Routing::removeRoute',sType: $('#type').val(),sPageToRemove: sPageToRemove,sModuleToConfigure: $('select#moduleToConfigure').val(),sSideToConfigure: $('select#sideToConfigure').val()});promise.success(function(data){$('div#ajaxFrame').html(data);});promise.error(function(){bootbox.alert('error');});}});return false;});$('div#ajaxFrame').on('click', '#saveRoutesButton', function(e){e.preventDefault();e.stopPropagation();var promise=genericRequest({app_token: getToken(), content: getCurrentPage(),exw_action: 'Routing::updateRoutes',routes:$('#routingForm').serialize(),sModuleToConfigure: $('select#moduleToConfigure').val(),sSideToConfigure: $('select#sideToConfigure').val()});promise.success(function(data){$('div#ajaxFrame').html(data);});promise.error(function(){bootbox.alert('error');});return false;});$('div#ajaxFrame').on('click', 'input.draftPreviewButton', function(e){var promise=genericRequest({app_token: getToken(), content: getCurrentPage(),exw_action: 'Drafts::getDraftUrl',sPage: $(this).prev().val(),sLang: $(this).parent().prev().find('select').val(),sSide: getCurrentPage()==='translations_back' ? 'BACK' : 'FRONT'});promise.success(function(data){window.open(data);});promise.error(function(){bootbox.alert('error');});return false;});$('div#ajaxFrame').on('click', 'input.versionPreviewButton', function(e){var promise=genericRequest({app_token: getToken(), content: getCurrentPage(),exw_action: 'Versions::getVersionUrl',sPage: $(this).prev().val(),sVersion: $(this).prev().prev().val(),sLang: $(this).parent().prev().find('select').val()});promise.success(function(data){window.open(data);});promise.error(function(){bootbox.alert('error');});return false;});$('div#ajaxFrame').on('click', 'input.applyVersionButton', function(e){var sPage=$(this).prev().val();var sVersion=$(this).prev().prev().val();bootbox.confirm($('input#applyVersionConfirm').val(), function(result){if(result){var promise=genericRequest({app_token: getToken(), content: getCurrentPage(),exw_action: 'Versions::applyVersion',sPage: sPage,sVersion: sVersion});promise.success(function(data){$('div#ajaxFrame').html(data);});promise.error(function(){bootbox.alert('error');});}});return false;});$('div#ajaxFrame').on('click', 'input.purgeVersionsButton', function(e){bootbox.confirm($('input#purgeVersionsConfirm').val(), function(result){if(result){var promise=genericRequest({app_token: getToken(), content: getCurrentPage(),exw_action: 'Versions::purgeVersions',sPage: $(this).prev().val()});promise.success(function(data){$('div#ajaxFrame').html(data);});promise.error(function(){bootbox.alert('error');});}});return false;});$('div#ajaxFrame').on('click', 'button.deleteVersionButton', function(){var sPage=$(this).prev().val();bootbox.confirm($('input#deleteVersionConfirm').val(), function(result){if(result){var promise=genericRequest({app_token: getToken(), content: getCurrentPage(),exw_action: 'Versions::deleteVersion',sPage: sPage});promise.success(function(data){$('div#ajaxFrame').html(data);});promise.error(function(){bootbox.alert('error');});}});return false;});$('div#ajaxFrame').on('click', 'a.errorLogsEntry', function(e){e.preventDefault();e.stopPropagation();var promise=genericRequest({app_token: getToken(), content: getCurrentPage(),exw_action: 'Logs::getErrorLogs',sDay:$(this).attr('alt')});promise.success(function(data){$('div#ajaxFrame').html(data);$('meta[name=app_current_page]').trigger('change');});promise.error(function(){bootbox.alert('error');});return false;});$('div#ajaxFrame').on('click', 'input#purgeOldLogsButton', function(e){e.preventDefault();e.stopPropagation();bootbox.confirm($('input#purgeOldLogsConfirm').val(), function(result){if(result){var promise=genericRequest({app_token: getToken(), content: getCurrentPage(),exw_action: 'Logs::purgeOldLogs'});promise.success(function(data){$('div#ajaxFrame').html(data);$('meta[name=app_current_page]').trigger('change');});promise.error(function(){bootbox.alert('error');});}});return false;});if($('.deleteMsgButton').is(':visible')){$('.showMessagesButton').show();$('.showArchivedMessagesButton').hide();}else{$('.showMessagesButton').hide();$('.showArchivedMessagesButton').show();}if($('.archiveMsgButton').is(':visible')){$('.showMessagesButton').hide();$('.showArchivedMessagesButton').show();}else{$('.showMessagesButton').show();$('.showArchivedMessagesButton').hide();}$('div#ajaxFrame').on('click', 'button.showMessagesButton', function(e){e.preventDefault();e.stopPropagation();var promise=genericRequest({app_token: getToken(), content: 'contact_messagesReceived',exw_action: 'Contact::getMsgsPage'},'contact_messagesReceived');promise.success(function(data){$('div#ajaxFrame').html(data);$('meta[name=app_current_page]').trigger('change');setHistoryAndMenu('contact_messagesReceived');$('.showMessagesButton').hide();$('.showArchivedMessagesButton').show();});promise.error(function(){bootbox.alert('error');});});$('div#ajaxFrame').on('click', 'button.showArchivedMessagesButton', function(e){e.preventDefault();e.stopPropagation();var promise=genericRequest({app_token: getToken(), content: 'contact_archivedMessages',exw_action: 'Contact::getArchivesPage'},'contact_archivedMessages');promise.success(function(data){$('div#ajaxFrame').html(data);$('meta[name=app_current_page]').trigger('change');setHistoryAndMenu('contact_archivedMessages');$('.showArchivedMessagesButton').hide();$('.showMessagesButton').show();});promise.error(function(){bootbox.alert('error');});});$('div#ajaxFrame').on('click', 'input.archiveMsgButton', function(e){e.preventDefault();e.stopPropagation();var sMsgId=$(this).closest('.msgForm').find('.contact_id').val();bootbox.confirm($("[name='confirmArchiveConfirm']").val(), function(result){if(result){var promise=genericRequest({app_token: getToken(), content: 'contact_messagesReceived',exw_action: 'Contact::archiveMsg',sMsgId: sMsgId}, 'contact_messagesReceived');promise.success(function(data){$('div#ajaxFrame').html(data);$('meta[name=app_current_page]').trigger('change');});promise.error(function(){bootbox.alert('error');});}});return false;});$('div#ajaxFrame').on('click', 'input.restoreMsgButton', function(e){e.preventDefault();e.stopPropagation();var promise=genericRequest({app_token: getToken(), content: 'contact_messagesReceived',exw_action: 'Contact::restoreMsg',sMsgId: $(this).closest('.msgForm').find('.contact_id').val()}, 'contact_messagesReceived');promise.success(function(data){$('div#ajaxFrame').html(data);$('meta[name=app_current_page]').trigger('change');});promise.error(function(){bootbox.alert('error');});return false;});$('div#ajaxFrame').on('click', 'button.deleteMsgButton', function(e){e.preventDefault();e.stopPropagation();var sMsgId=$(this).closest('.msgForm').find('.contact_id').val();bootbox.confirm($("[name='confirm_delete']").val(), function(result){if(result){var promise=genericRequest({app_token: getToken(), content: 'contact_archivedMessages',exw_action: 'Contact::deleteMsg',sMsgId: sMsgId}, 'contact_archivedMessages');promise.success(function(data){$('div#ajaxFrame').html(data);$('meta[name=app_current_page]').trigger('change');});promise.error(function(){bootbox.alert('error');});}});return false;});$('div#ajaxFrame').on('click', 'input.updateCommentButton', function(e){e.preventDefault();e.stopPropagation();var promise=genericRequest({app_token: getToken(), content: getCurrentPage(),exw_action: 'Contact::getEditComment',sMsgId: $(this).closest('.msgForm').find('.contact_id').val(),sComment: $(e.target).closest('.msgForm').find('.msgComment').text()});promise.success(function(data){$(e.target).closest('.msgForm').find('.comment-zone').html(data);});promise.error(function(){bootbox.alert('error');});return false;});$('div#ajaxFrame').on('click', 'input.saveCommentButton', function(e){e.preventDefault();e.stopPropagation();var promise=genericRequest({app_token: getToken(), content: getCurrentPage(),exw_action: 'Contact::saveComment',sMsgId: $(this).closest('.msgForm').find('.contact_id').val(),sComment: $(this).closest('.msgForm').find('.msgComment').val()});promise.success(function(data){$(e.target).closest('.msgForm').find('.comment-zone').html(data);});promise.error(function(){bootbox.alert('error');});return false;});$('div#ajaxFrame').on('click', 'input#msgSearchButton', function(e){e.preventDefault();e.stopPropagation();var promise=genericRequest({app_token: getToken(), content: 'contact_messagesReceived',exw_action: 'Contact::searchMsg',sKeyword: $('#msgKeyword').val()}, 'contact_messagesReceived');promise.success(function(data){$('div#ajaxFrame').html(data);});promise.error(function(){bootbox.alert('error');});return false;});});